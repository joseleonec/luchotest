-- PostgreSQL Database Schema
SET statement_timeout = 0;
SET lock_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;

-- Estructura de la tabla 'persona'
CREATE TABLE public.persona (
    id bigint NOT NULL,
    direccion character varying(255),
    edad integer,
    genero character varying(255),
    identificacion character varying(255),
    nombre character varying(255),
    telefono character varying(255)
);

-- Estructura de la tabla 'cliente'
CREATE TABLE public.cliente (
    cliente_id character varying(255) NOT NULL,
    contrasena character varying(255),
    estado character varying(255),
    id bigint NOT NULL
);

-- Estructura de la tabla 'cuenta' e identidad
CREATE TABLE public.cuenta (
    id bigint NOT NULL,
    estado character varying(255) NOT NULL,
    numero_cuenta character varying(255) NOT NULL,
    saldo_inicial numeric(38,2) NOT NULL,
    tipo_cuenta character varying(255) NOT NULL,
    cliente_id bigint NOT NULL
);

ALTER TABLE public.cuenta ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.cuenta_id_seq
    START WITH 1
    INCREMENT BY 1
);

-- Estructura de la tabla 'movimiento' e identidad
CREATE TABLE public.movimiento (
    id bigint NOT NULL,
    fecha timestamp(6) without time zone NOT NULL,
    saldo numeric(38,2) NOT NULL,
    tipo_movimiento character varying(255),
    valor numeric(38,2) NOT NULL,
    cuenta_id bigint NOT NULL
);

ALTER TABLE public.movimiento ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.movimiento_id_seq
    START WITH 1
    INCREMENT BY 1
);

-- Secuencia para persona
CREATE SEQUENCE public.persona_seq
    START WITH 1
    INCREMENT BY 50
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

-- Constraints y Llaves Primarias
ALTER TABLE ONLY public.persona ADD CONSTRAINT persona_pkey PRIMARY KEY (id);
ALTER TABLE ONLY public.cliente ADD CONSTRAINT cliente_pkey PRIMARY KEY (id);
ALTER TABLE ONLY public.cliente ADD CONSTRAINT ukkou3iuyp26clwwj9m5d0e6t0l UNIQUE (cliente_id);
ALTER TABLE ONLY public.cuenta ADD CONSTRAINT cuenta_pkey PRIMARY KEY (id);
ALTER TABLE ONLY public.cuenta ADD CONSTRAINT ukpj7ncg765kt4klndu25bwbwe4 UNIQUE (numero_cuenta);
ALTER TABLE ONLY public.movimiento ADD CONSTRAINT movimiento_pkey PRIMARY KEY (id);

-- Llaves Foráneas (Foreign Keys)
ALTER TABLE ONLY public.cliente ADD CONSTRAINT fkkpvkbjg32bso6riqge70hwcel FOREIGN KEY (id) REFERENCES public.persona(id);
ALTER TABLE ONLY public.cuenta ADD CONSTRAINT fk4p224uogyy5hmxvn8fwa2jlug FOREIGN KEY (cliente_id) REFERENCES public.cliente(id);
ALTER TABLE ONLY public.movimiento ADD CONSTRAINT fk4ea11fe7p3xa1kwwmdgi9f2fi FOREIGN KEY (cuenta_id) REFERENCES public.cuenta(id);


-- data 

-- PostgreSQL Database Data
SET statement_timeout = 0;
SELECT pg_catalog.set_config('search_path', '', false);

-- Datos: persona
INSERT INTO public.persona (id, direccion, edad, genero, identificacion, nombre, telefono) 
VALUES (1, 'Otavalo sn y principal', 30, 'Masculino', '000000001', 'Jose Lema', '098254785') 
ON CONFLICT (id) DO NOTHING;

INSERT INTO public.persona (id, direccion, edad, genero, identificacion, nombre, telefono) 
VALUES (2, 'Amazonas y NNUU', 30, 'Femenino', '000000002', 'Marianela Montalvo', '097548965') 
ON CONFLICT (id) DO NOTHING;

INSERT INTO public.persona (id, direccion, edad, genero, identificacion, nombre, telefono) 
VALUES (3, '13 junio y Equinoccial', 30, 'Masculino', '000000003', 'Juan Osorio', '098874587') 
ON CONFLICT (id) DO NOTHING;


-- Datos: cliente
INSERT INTO public.cliente (cliente_id, contrasena, estado, id) 
VALUES ('joselema', '1234', 'True', 1) 
ON CONFLICT (id) DO NOTHING;

INSERT INTO public.cliente (cliente_id, contrasena, estado, id) 
VALUES ('marianelamontalvo', '5678', 'True', 2) 
ON CONFLICT (id) DO NOTHING;

INSERT INTO public.cliente (cliente_id, contrasena, estado, id) 
VALUES ('juanosorio', '1245', 'True', 3) 
ON CONFLICT (id) DO NOTHING;


-- Datos: cuenta
INSERT INTO public.cuenta (id, estado, numero_cuenta, saldo_inicial, tipo_cuenta, cliente_id) 
VALUES (5, 'True', '585545', 1000.00, 'Corriente', 1) 
ON CONFLICT (id) DO NOTHING;

INSERT INTO public.cuenta (id, estado, numero_cuenta, saldo_inicial, tipo_cuenta, cliente_id) 
VALUES (1, 'True', '478758', 1425.00, 'Ahorro', 1) 
ON CONFLICT (id) DO NOTHING;

INSERT INTO public.cuenta (id, estado, numero_cuenta, saldo_inicial, tipo_cuenta, cliente_id) 
VALUES (2, 'True', '225487', 700.00, 'Corriente', 2) 
ON CONFLICT (id) DO NOTHING;

INSERT INTO public.cuenta (id, estado, numero_cuenta, saldo_inicial, tipo_cuenta, cliente_id) 
VALUES (3, 'True', '495878', 150.00, 'Ahorros', 3) 
ON CONFLICT (id) DO NOTHING;

INSERT INTO public.cuenta (id, estado, numero_cuenta, saldo_inicial, tipo_cuenta, cliente_id) 
VALUES (4, 'True', '496825', 0.00, 'Ahorros', 2) 
ON CONFLICT (id) DO NOTHING;


-- Datos: movimiento
INSERT INTO public.movimiento (id, fecha, saldo, tipo_movimiento, valor, cuenta_id) 
VALUES (1, '2026-01-17 16:03:47.82008', 1425.00, 'RETIRO', -575.00, 1) 
ON CONFLICT (id) DO NOTHING;

INSERT INTO public.movimiento (id, fecha, saldo, tipo_movimiento, valor, cuenta_id) 
VALUES (2, '2026-01-17 16:04:19.903991', 700.00, 'DEPOSITO', 600.00, 2) 
ON CONFLICT (id) DO NOTHING;

INSERT INTO public.movimiento (id, fecha, saldo, tipo_movimiento, valor, cuenta_id) 
VALUES (3, '2026-01-17 16:04:37.698073', 150.00, 'DEPOSITO', 150.00, 3) 
ON CONFLICT (id) DO NOTHING;

INSERT INTO public.movimiento (id, fecha, saldo, tipo_movimiento, valor, cuenta_id) 
VALUES (4, '2026-01-17 16:04:59.187209', 0.00, 'RETIRO', -540.00, 4) 
ON CONFLICT (id) DO NOTHING;


-- Sincronización de Secuencias
SELECT pg_catalog.setval('public.cuenta_id_seq', 5, true);
SELECT pg_catalog.setval('public.movimiento_id_seq', 4, true);
SELECT pg_catalog.setval('public.persona_seq', 51, true);